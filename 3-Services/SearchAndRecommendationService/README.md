# Search and Recommendation Service

## Introduction

The **Search and Recommendation Service** is a core backend component of the Monjoor platform. It provides intelligent, semantic search and AI-driven video recommendations for language learning content. This service leverages Elasticsearch for scalable indexing and search, integrates LLMs (such as OpenAI) for advanced language processing, and connects with the main Monjoor backend to deliver personalized results.

The app is built with **Python** (Flask) and can be deployed both locally or in the cloud. It communicates with other Monjoor services via RESTful APIs and is optimized for low-latency, high-quality recommendations.

## Most important

**Notes:**

* Before starting the service, you must ensure that you have already set up you elasticsearch index.

---

## Environment Configuration

Before starting the service, **create a `.env` file in the project root** with the following variables.
Replace the values in angle brackets with your actual credentials.

```env
################################################
#              ELASTICSEARCH CONF              #
################################################
ELASTICSEARCH_URL="https://<your_elasticsearch_host>:9200"
ELASTICSEARCH_USER="<your_elasticsearch_username>"
ELASTICSEARCH_PASSWORD="<your_elasticsearch_password>"
ELASTICSEARCH_INDEX_NAME_VIDEOS="monjoor-videos-index"

################################################
#                 API KEY CONF                 #
################################################
OPENAI_API_KEY="<your_openai_api_key>"
```

**Notes:**

* Do **not** commit your `.env` to version control.
* Surround URLs and keys with quotes only if your library/parsing expects it (Python's `os.getenv` does not require them, but they're safe to include).
* All variables are required for the service to function.

---

## Deployment

### Run Locally

**1. Install dependencies:**

```bash
pip install -r requirements.txt
```

**2. Set up your environment:**

* Place your `.env` file at the project root.
* Place your Google service account JSON in the location specified in `.env`.

**3. Start the Flask server:**

```bash
python app.py
```

* The service will be available by default at `http://localhost:8084/` 

---

### Deploy with Docker

**To run the service in a Docker container:**

```bash
docker build -t monjoor-search .
docker run -p 8084:8084 --env-file .env -v $(pwd)/path/to/key.json:/app/<your-vertex-ai-key>.json monjoor-search
```

* The service will be available at [http://localhost:8084](http://localhost:8084)

---

### Deploy on Google Cloud Run

You can deploy this service to Google Cloud Run for scalability and easy integration with other GCP services.
Be sure your environment variables and key files are securely handled (via Secret Manager or build-time substitution).

---

## API Endpoints

| Method | Endpoint                  | Arguments (**required**)                        | Description                                     |
| ------ | ------------------------- | ----------------------------------------------- | ----------------------------------------------- |
| GET    | `/autocomplete`           | `query` (str, URL param), `userLanguage` (str)  | Get autocomplete suggestions for search terms   |
| POST   | `/vector-search`          | `query` (str, JSON)                             | Search for videos with semantic/keyword queries |
| POST   | `/get-recommended-videos` | `videoId` (str, JSON), `transcript` (str, JSON) | Get AI-powered video recommendations            |
| POST   | `/get-video-embeddings`   | `transcript` (str, JSON)                        | Get vector embeddings for a transcript          |
| POST   | `/get-video-keywords`     | `transcript` (str, JSON)                        | Get keywords generated by GPT for a transcript  |


**For more details or API examples, see the [Postman collection](../../5-Postman/) or your API documentation.**

---

## Additional Information

* **Framework:** Python (Flask)
* **Search Engine:** Elasticsearch 7.x/8.x
* **LLM Providers:** OpenAI, Hugging Face
* **Cloud Deployment:** Google Cloud Run (recommended), Docker, or any cloud VM

---

## Troubleshooting

* If you see connection errors to Elasticsearch or the backend, ensure your `.env` variables are correct and the required services are running.
* For OpenAI/LLM errors, check that your API key has sufficient quota and is valid.

---

## Security

* **Never commit your `.env` or service account key files to Git!**
* Restrict API keys to only necessary permissions.

